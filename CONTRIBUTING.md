# Installing the project
This project was built with [poetry](https://python-poetry.org) in mind as the means to manage dependencies. You can follow their [install guide](https://python-poetry.org/docs/#installation) to install it.

Having poetry installed, the following command will install the project into a new environment.

```bash
poetry install
```

Keep in mind that this will by default install the base requirements as well as the dev requirements.

Remember to commit to the repo the `poetry.lock` file generated by `poetry install`.

## Adding new dependencies
Check the full [poetry](https://python-poetry.org) docs, but here goes a quick reminder,

```bash
poetry add <dependency> [--dev]
```

*Always* remember to commit changes to `poetry.lock`!

# Installing pre-commit hooks
We use [pre-commit](https://pre-commit.com) to run several code scans and hooks that make the development cycle easier.
```bash
poetry run pre-commit install
poetry run pre-commit install -t pre-push
```

## Bumping SemVer version
We use [SemVer](https://semver.org). Use poetry to bump the version:

```bash
poetry version <major|minor|patch>
```

## Style guide
`careerwise` follows [PEP8](https://www.python.org/dev/peps/pep-0008/).

If you installed the [pre-commit hooks](#installing-pre-commit-hooks) you shouldn't worry too much about style, since they will fix it for you or warn you about styling errors. We use the following hooks:

- [black](https://github.com/psf/black): An opinionated code formatting tool that ensures consistency across all projects using it
- [mypy](https://github.com/python/mypy): a static type checker for Python
- [pylint](https://github.com/PyCQA/pylint): a source code, bug and quality checker
- [isort](https://pycqa.github.io/isort/): isort is a Python utility / library to sort imports alphabetically, and automatically separated into sections and by type.

## Docstrings
We use either [numpy style](https://numpydoc.readthedocs.io/en/latest/format.html) or [google style](https://github.com/google/styleguide/blob/gh-pages/pyguide.md#38-comments-and-docstrings) docstring formatting. It's usually good to include the following docstrings:
- module level docstring giving a general overview of what it does.
- class dosctrings explaining what it is
- method/functions to explain what it does and what it's parameters are

## Testing
We use the [pytest framework](https://docs.pytest.org/en/latest/) to test `careerwise`. The easiest way to run tests it like so: `poetry run pytest`.

# GitHub Actions
A few pipelines have been set to run on github actions to ensure code quality.

## `bandit.yml`
This workflow runs bandit, scanning for vulnerabilities.

## `linters.yml`
Run linters and code quality checkers.

## `tests.yml`
Run tests to avoid regressions before merging.

# Documentation

## Swagger
You can visit the OpenAPI docs at `127.0.0.1:5000/docs` when the app is running.

# Running the webapp
## Locally
1. Copy `settings_sample.ini` into `settings.ini`, or set the env vars that match that config.
2. `poetry install`
2. `poetry run uvicorn careerwise.api.app:app --port 5000 --reload`

## With Docker
Use the `Dockerfile` on the project root.

```bash
docker build -t careerwise:latest .
docker run -d --rm --expose 5000:5000 --name careerwise careerwise:latest
```

_Note_: You can set the following env vars for the entrypoint to use.
- `API_PORT`: Defaults to 5000
- `API_WORKERS`: Defaults to 4

## With docker compose
This is currently used for development purposes.
From the root of the project, `docker-compose -f docker/docker-compose.yaml -v .:/app`.


# Migrations
## Upgrading the DB to the latest migration
```bash
poetry run alembic --config migrations/alembic.ini upgrade head
```

## Creating a new migration
```bash
poetry run alembic --config migrations/alembic.ini revision --autogenerate -m "migration message"
```
